<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>LogpileWeb.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">server</a> &gt; <a href="index.html" class="el_package">org.skarb.logpile.vertx.web</a> &gt; <span class="el_source">LogpileWeb.java</span></div><h1>LogpileWeb.java</h1><pre class="source lang-java linenums">package org.skarb.logpile.vertx.web;

import org.skarb.logpile.vertx.EventManager;
import org.skarb.logpile.vertx.MainVerticle;
import org.skarb.logpile.vertx.handler.DeployVerticle;
import org.vertx.java.core.Handler;
import org.vertx.java.core.eventbus.Message;
import org.vertx.java.core.json.JsonArray;
import org.vertx.java.core.json.JsonObject;
import org.vertx.java.deploy.Verticle;

/**
 * User: skarb
 * Date: 04/01/13
 */
<span class="fc" id="L16">public class LogpileWeb extends Verticle implements Handler&lt;Message&lt;JsonObject&gt;&gt; {</span>

    static final String WEB_SERVER = &quot;web_server&quot;;
    static final String SERVER_STATUS = &quot;logpile.server-status&quot;;
    public static final String SERVICES_FIELD = &quot;services&quot;;
    public static final String CONFIG_FIELD = &quot;config&quot;;


    /**
     *
     * @throws Exception
     */
    @Override
    public void start() throws Exception {
        // launch web server.
<span class="fc" id="L31">        final JsonObject configWebServer = getContainer().getConfig().getObject(WEB_SERVER);</span>
<span class="fc" id="L32">        getContainer().deployModule(&quot;vertx.web-server-v1.0&quot;, configWebServer, configWebServer.getInteger(MainVerticle.INSTANCE_FIELD));</span>
        // Authorization manager.
<span class="fc" id="L34">        getContainer().deployVerticle(AuthManagerJSonFile.class.getName(), getContainer().getConfig(), configWebServer.getInteger(MainVerticle.INSTANCE_FIELD),</span>
                new DeployVerticle(getContainer(), AuthManagerJSonFile.class));

        //
<span class="fc" id="L38">        getVertx().eventBus().registerHandler(SERVER_STATUS,this);</span>
<span class="fc" id="L39">    }</span>


    @Override
    public void handle(final Message&lt;JsonObject&gt; message) {
       /* message.reply (
                new JsonObject().putObject(CONFIG_FIELD, getContainer().getConfig()));
       */
<span class="fc" id="L47">        getVertx().eventBus().send(EventManager.SERVICE_STATE, new JsonArray(), new Handler&lt;Message&lt;JsonArray&gt;&gt;() {</span>
            @Override
            public void handle(Message&lt;JsonArray&gt; lgState) {
<span class="nc" id="L50">               message.reply (</span>
                        new JsonObject().putArray(SERVICES_FIELD, lgState.body).putObject(CONFIG_FIELD, getContainer().getConfig()));
<span class="nc" id="L52">            }</span>
        });
<span class="fc" id="L54">    }</span>


}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.5.6.201201232323</span></div></body></html>